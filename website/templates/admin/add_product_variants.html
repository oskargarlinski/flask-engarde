{% extends 'base.html' %}
{% block title %}
  Define Product Variants
{% endblock %}

{% block content %}
  <div class="container py-5">
    <h1 class="mb-4">Add Variants for {{ product.name }}</h1>

    <form method="POST">
      {% for form, combo in variant_forms %}
        <div class="border rounded p-4 mb-4">
          <h5>
            Variant {{ loop.index }}:
            {{ combo|map(attribute='value')|join(', ') }}
            {% if form.price.data %}
              <span class="badge bg-success" id="status-{{ loop.index0 }}">Saved</span>
            {% endif %}
          </h5>

          <div class="row mt-3">
            <div class="col-md-4">{{ form.price.label(class='form-label') }}
              {{ form.price(class='form-control') }}</div>
            <div class="col-md-4">{{ form.environmental_impact.label(class='form-label') }}
              {{ form.environmental_impact(class='form-control') }}</div>
            <div class="col-md-4">{{ form.sku.label(class='form-label') }}
              {{ form.sku(class='form-control', readonly=true) }}</div>
            <div class="col-md-4">{{ form.stock.label(class='form-label') }}
              {{ form.stock(class='form-control') }}</div>
          </div>
        </div>
      {% endfor %}

      <button type="submit" class="btn btn-dark">Save All Variants</button>
    </form>
  </div>

  <script>
    document.querySelectorAll('.border.rounded').forEach((block, index) => {
      const inputs = block.querySelectorAll('input')
      const badge = block.querySelector(`#status-${index}`)
    
      inputs.forEach((input) => {
        input.addEventListener('input', () => {
          if (badge && !badge.classList.contains('bg-warning')) {
            badge.textContent = 'Unsaved'
            badge.classList.remove('bg-success')
            badge.classList.add('bg-warning')
          }
        })
      })
    })
  </script>
{% endblock %}
